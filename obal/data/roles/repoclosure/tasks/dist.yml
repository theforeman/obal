- name: 'Run repoclosure for {{ item }}'
  command: >
    repoclosure
      --config {{ inventory_dir }}/{{ repoclosure_config }}
      --tempcache
      --newest
      --repoid {{ repoclosure_target_repos | join(' --repoid ') }}
      --repofrompath=downloaded_rpms,./downloaded_rpms/{{ item }}
      {{ additional_repos | join(' ') }}
      {{ '--lookaside ' if repoclosure_lookaside_repos else '' }}
      {{ repoclosure_lookaside_repos[item] | join(' --lookaside ') }}
  register: output
  when: output is not defined
  args:
    chdir: "{{ inventory_dir }}"

- debug:
    msg: "{{ output.stdout_lines | join('\n') }}"
